flowchart LR

%%subgraph inputs["Girdiler"]
%%  direction LR
   dzc["$$D_{\mathrm{ZED}}^{c}$$"]:::data
   dlc["$$D_{\mathrm{L}}^{c}$$"]:::data
   dfit["$$D_{\mathrm{fit}}(v,u)$$"]:::data
%%end

subgraph dmf2["Uyumlanmış Derinlik Haritası Maskeleme"]
  direction TB
  gate["Tutarlılık kapısı <br/> $$|D_{\mathrm{ZED}}^{c}-D_{\mathrm{L}}^{c}|\le\tau$$"]:::stage
  ml["$$M_{\mathrm{L}}$$"]:::data

  fit["Uyumlama <br/> $$D_{\mathrm{fit}}^{c} = D_{\mathrm{L}}^{c}\ \text{if } M_{\mathrm{L}}=1$$"]:::stage
  merge["ROI → tam görüntü"]:::stage
  reapply["Maskeyi geri uygula <br/> $$M=1 \Rightarrow D_{\mathrm{fit}}=\mathrm{NaN}$$"]:::stage
end

dzc --> gate
dlc --> gate --> ml
dzc --> fit
dlc --> fit
ml --> fit --> merge --> reapply --> dfit

%% ====== COLOR PALETTE (ACADEMIC) ======
classDef stage fill:#4e79a7, stroke:#2f4b7c, color:#ffffff, rx:6, ry:6;
classDef data fill:#e0e0e0, stroke:#7f7f7f, color:#000000, rx:4, ry:4;
classDef topic fill:#f3e6c9, stroke:#bfa980, color:#000000, rx:4, ry:4;
classDef decision fill:#cfe8d5, stroke:#6b8f71, color:#000000, rx:6, ry:6;

